# 開発マイルストーン

このプロジェクトは「操縦系（BLE＋サーボ制御）」を先に固め、将来「映像（Pi/WebRTC）」を統合します。
ここでは “カメラなしプロト” を中心にマイルストーンを定義します。

---

## M0: リポジトリ基盤（Monorepo）整備
**目的**: アプリとFWを同じリポジトリで無理なく回す。

**成果物**
- ディレクトリ構成の確定
- README / Milestone / BACKLOG の整備
- shared/protocol の“正本”設置（最小仕様でOK）

**受入基準**
- 新規メンバーが README を見て “どこに何があるか” 迷わない
- FWとiOSが独立してビルド/実行できる（依存は未整備でも手順は記述）

---

## M1: FW Bring-up（I2C + PCA9685 + 手動BLE Write）
**目的**: MCU単体で「BLEで受けてPCA9685を更新」が成立する。

**成果物**
- Zephyr: XIAO nRF52840向けビルド
- PCA9685（I2C）疎通とPWM出力（50Hz）
- BLE: GATTサービス/Characteristic（Write/Notify）
- 手動コマンドでサーボ1chが動く

**受入基準**
- BLEテストアプリから Write するとサーボが所定角度へ動く
- 同じ操作を10回以上繰り返してもハングしない

---

## M2: 安全停止（ARM/DISARM + デッドマン）と最小テレメトリ
**目的**: “止まるべき時に止まる” を先に固める。

**成果物**
- ARM/DISARM（接続しただけでは動かない）
- デッドマン（例: 200ms無通信で停止）
- テレメトリ（バッテリー電圧/状態/エラーコード）

**受入基準**
- 切断/無通信で確実に停止する
- テレメトリが所定周期で通知される（例: 10Hz）

---

## M3: iOSアプリ MVP（操縦UI + 周期送信）
**目的**: iPadから “操縦として使える” 体験を作る。

**成果物**
- スキャン/接続/再接続
- ARM/DISARM UI
- 仮想スティック（vx/vy/yaw など）または最低限の操作UI
- 30–60Hz程度の周期送信（詰まり対策: 最新値のみ送信）
- テレメトリ表示（電圧/状態/エラー）

**受入基準**
- iPadからの操作で意図通りに動く
- 一時的なBLE詰まり/再接続でも暴走しない（安全側へ遷移）

---

## M4: 複数チャンネル対応（>= 16ch / 2枚PCA9685）とキャリブレーション
**目的**: 6脚を見据えて、複数サーボの安定更新と調整手順を確立する。

**成果物**
- PCA9685複数枚（アドレス違い）
- サーボ中心/リミットのキャリブレーション機能（FW側に保持）
- まとめ更新（I2Cバッチ）で周期を安定化

**受入基準**
- 16ch以上を同時に動かしてもFWが落ちない
- キャリブレーション手順が docs に明文化されている

---

## M5: （将来）Pi統合（映像/WebRTC + 操作統合）
**目的**: Piで映像を配信しつつ、操縦系（BLEまたは有線/別経路）を統合する。

**成果物**
- Pi側の映像配信方式（WebRTC等）の選定
- iPadのUI統合方針（BLE+映像 or Pi集約）
- shared/protocol を転送路非依存にする設計

**受入基準**
- 遅延要件を満たす映像＋操縦が成立する
- 操縦の安全性が維持される（切断時停止等）

